<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evoluci√≥n de mi Peso</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#16a34a">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    canvas {
      width: 100% !important;
      height: 300px !important;
    }
    td button {
      background: none !important;
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
    }
    td button::before,
    td button::after {
      content: none !important;
      display: none !important;
    }
  </style>
</head>

<body class="bg-green-50 min-h-screen p-4">



  <!-- ==========================
       BLOQUE: SEGUIMIENTO SEMANAL
       ========================== -->
  <div id="menuSemanal" class="block">
    <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">

      <h1 class="text-3xl font-bold text-center text-green-700 mb-2">
        ü•ë Evoluci√≥n de mi Peso ü•ù
      </h1>
      <p id="fraseMotivacion" class="text-center text-lg font-semibold text-green-700 mb-6"></p>

      <div class="flex justify-center mb-6">
        <img src="Obesmedica.png" alt="Obesmedica" class="h-20 w-auto" />
      </div>

      <div class="flex gap-4 justify-center mb-6">
  <button onclick="mostrarSemanal()" 
          class="bg-green-600 text-white px-4 py-2 rounded">
    Seguimiento semanal
  </button>

  <button onclick="mostrarMensual()" 
          class="bg-green-700 text-white px-4 py-2 rounded">
    Seguimiento mensual
  </button>
</div>


      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <input id="fecha" type="date" class="border p-2 rounded w-full" />
        <select id="tipoDieta" class="border p-2 rounded w-full">
          <option value="SF">Sin fruta</option>
          <option value="CF">Con fruta</option>
        </select>
        <input id="peso" type="number" step="0.1" class="border p-2 rounded w-full" placeholder="Peso (kg)" />
        <button onclick="agregarPeso()" class="bg-green-600 text-white p-2 rounded hover:bg-green-700">A√±adir</button>
      </div>

 
      <table class="w-full mb-2">
     <thead>
  <tr class="bg-green-200">
  <th class="p-2">
  <div class="flex items-center justify-center gap-2">
    <span>Fecha</span>

    <!-- Contenedor de flechas -->
    <div class="flex gap-1">
      <button onclick="ordenarAsc()" class="text-green-700 text-lg font-bold">
        ‚¨ÜÔ∏è
      </button>
      <button onclick="ordenarDesc()" class="text-green-700 text-lg font-bold">
        ‚¨áÔ∏è
      </button>
    </div>
  </div>
</th>


    <th class="p-2">Dieta</th>
    <th class="p-2">Variaci√≥n</th>
    <th class="p-2">Peso (kg)</th>
    <th class="p-2">Borrar</th>
  </tr>
</thead>

        <tbody id="tabla"></tbody>
      </table>

      <p id="totalPerdido" class="text-right text-green-700 font-bold mb-6"></p>
      <p id="desgloseDietas" class="text-right text-green-700 font-semibold mb-6"></p>

      <h2 class="text-xl font-bold text-green-700 mb-2">üìâ Gr√°fico de evoluci√≥n</h2>
      <canvas id="grafico"></canvas>

      <button onclick="limpiarTodo()" class="bg-red-500 text-white p-2 mt-6 rounded hover:bg-red-600 w-full">
        Limpiar todo üöÆ
      </button>

    </div>
  </div>

  <!-- ==========================
       BLOQUE: SEGUIMIENTO MENSUAL
       ========================== -->
  <div id="menuMensual" class="hidden">
<div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">

  <!-- Bot√≥n volver -->
  <button onclick="mostrarSemanal()"
          class="bg-green-600 text-white px-4 py-2 rounded mb-6">
    ‚Üê Volver
  </button>

  <h1 class="text-3xl font-bold text-center text-green-700 mb-4">
    üìÖ Seguimiento mensual
  </h1>

  <p class="text-center text-gray-700 mb-6">
    Introduce tu altura para calcular el IMC.
  </p>

  <!-- CAMPO ALTURA -->
  <div class="flex justify-center mb-6">
    <input id="alturaUsuario"
           type="number"
           step="0.01"
           placeholder="Altura en cent√≠metros (ej. 1.60)"
           class="border p-2 rounded w-40 text-center">
    <button onclick="actualizarMensual()"
            class="bg-green-600 text-white px-4 py-2 rounded ml-3">
      Calcular IMC
    </button>
  </div>

  <!-- TABLA MENSUAL -->
  <table class="w-full mb-6">
    <thead>
      <tr class="bg-green-200">
        <th class="p-2">Fecha</th>
        <th class="p-2">IMC</th>
      </tr>
    </thead>
    <tbody id="tablaMensual"></tbody>
  </table>

</div>


  <script>
    // -------------------------
    // DATOS
    // -------------------------
    let datos = JSON.parse(localStorage.getItem("registroPeso")) || [];
    let grafico = null;
    let ordenActual = "asc";

    function guardar() {
      localStorage.setItem("registroPeso", JSON.stringify(datos));
    }

    function formatearFecha(fechaISO) {
      if (!fechaISO) return "";
      const [a, m, d] = fechaISO.split("-");
      return `${d}.${m}.${a}`;
    }

    // -------------------------
    // FRASE MOTIVADORA
    // -------------------------
    const frases = [
      "Un d√≠a m√°s sumando, no restando.",
      "Cada paso cuenta, aunque sea peque√±o.",
      "Tu yo del futuro te va a dar las gracias.",
      "Sigue as√≠, ya has demostrado que puedes.",
      "No es magia, es constancia. Y t√∫ la tienes.",
      "Hoy tambi√©n merece la pena intentarlo."
    ];

    function mostrarFrase() {
      const frase = frases[Math.floor(Math.random() * frases.length)];
      const el = document.getElementById("fraseMotivacion");
      if (el) el.textContent = frase;
    }

    // -------------------------
    // OPERACIONES PRINCIPALES
    // -------------------------
    function agregarPeso() {
      const fecha = document.getElementById("fecha").value;
      const peso = parseFloat(document.getElementById("peso").value);
      const tipoDieta = document.getElementById("tipoDieta").value;

      if (!fecha || isNaN(peso)) {
        alert("Completa los dos campos.");
        return;
      }

      datos.push({ fecha, peso, tipoDieta });

      datos.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

      guardar();
      actualizarTabla();
      actualizarGrafico();
    }

    function borrarPeso(index) {
      if (!confirm("¬øBorrar este registro?")) return;
      datos.splice(index, 1);
      guardar();
      actualizarTabla();
      actualizarGrafico();
    }

    function limpiarTodo() {
      if (!confirm("¬øSeguro que quieres borrar todo?")) return;
      datos = [];
      guardar();
      actualizarTabla();
      actualizarGrafico();
    }

    // -------------------------
    // TOTAL PERDIDO
    // -------------------------
    function calcularTotalPerdido() {
      const textoEl = document.getElementById("totalPerdido");
      const desgloseEl = document.getElementById("desgloseDietas");

      if (datos.length < 2) {
        textoEl.textContent = "";
        desgloseEl.textContent = "";
        return;
      }

      const ordenados = [...datos].sort(
        (a, b) => new Date(a.fecha) - new Date(b.fecha)
      );

      const primero = ordenados[0].peso;
      const ultimo = ordenados[ordenados.length - 1].peso;

      const diff = +(ultimo - primero).toFixed(1);

      let texto;
      if (diff < 0) texto = `Total perdido: ${Math.abs(diff)} kg`;
      else if (diff > 0) texto = `Has ganado ${diff} kg`;
      else texto = "Sin cambios";

      textoEl.textContent = texto;

      const sf = ordenados.filter(d => d.tipoDieta === "SF");
      const cf = ordenados.filter(d => d.tipoDieta === "CF");

      function perdida(arr) {
        if (arr.length < 2) return 0;
        const primero = arr[0].peso;
        const ultimo = arr[arr.length - 1].peso;
        return +(ultimo - primero).toFixed(1);
      }

      const perdidaSF = perdida(sf);
      const perdidaCF = perdida(cf);

      let textoSF =
        perdidaSF < 0 ? `SF: ${Math.abs(perdidaSF)} kg perdidos` :
        perdidaSF > 0 ? `SF: ${perdidaSF} kg ganados` :
        `SF: sin cambios`;

      let textoCF =
        perdidaCF < 0 ? `CF: ${Math.abs(perdidaCF)} kg perdidos` :
        perdidaCF > 0 ? `CF: ${perdidaCF} kg ganados` :
        `CF: sin cambios`;

      desgloseEl.textContent = `${textoSF} | ${textoCF}`;
    }
// ==========================
// SEGUIMIENTO MENSUAL
// ==========================
function actualizarMensual() {
  const tabla = document.getElementById("tablaMensual");
  const alturaInput = document.getElementById("alturaUsuario");

  if (!tabla || !alturaInput) return;

 // Altura en cent√≠metros
const alturaCm = parseFloat(alturaInput.value);

// Validaci√≥n
if (isNaN(alturaCm) || alturaCm <= 0) {
  tabla.innerHTML = `
    <tr><td colspan="2" class="p-4 text-center text-red-600">
      Introduce una altura v√°lida.
    </td></tr>
  `;
  return;
}

// Convertir a metros
const altura = alturaCm / 100;


  tabla.innerHTML = "";

  const ordenados = [...datos].sort(
    (a, b) => new Date(a.fecha) - new Date(b.fecha)
  );

  ordenados.forEach(entry => {
    const imc = (entry.peso / (altura * altura)).toFixed(1);

    tabla.innerHTML += `
      <tr class="border-b">
        <td class="p-2">${formatearFecha(entry.fecha)}</td>
        <td class="p-2">${imc}</td>
      </tr>
    `;
  });
}

    // -------------------------
    // TABLA
    // -------------------------
    function actualizarTabla() {
      const tabla = document.getElementById("tabla");
      tabla.innerHTML = "";

      const variaciones = datos.map((item, i) => {
        if (i === 0) return "-";
        const diff = item.peso - datos[i - 1].peso;
        return diff.toFixed(1) + " kg";
      });

      const indices = datos.map((_, i) => i);
      if (ordenActual === "desc") indices.reverse();

      indices.forEach((idx) => {
        const entry = datos[idx];
        const variacion = variaciones[idx];

        tabla.innerHTML += `
          <tr class="border-b">
            <td class="p-2">${formatearFecha(entry.fecha)}</td>
            <td class="p-2">${entry.tipoDieta || "-"}</td>
            <td class="p-2">${variacion}</td>
            <td class="p-2">${entry.peso}</td>
            <td class="p-2 text-center">
              <button onclick="borrarPeso(${idx})" class="text-purple-600 font-bold text-xl">‚úñ</button>
            </td>
          </tr>
        `;
      });

      calcularTotalPerdido();
    }

    // -------------------------
    // GR√ÅFICO
    // -------------------------
    function actualizarGrafico() {
      const canvas = document.getElementById("grafico");
      const ctx = canvas.getContext("2d");

      if (grafico) grafico.destroy();

      const ordenados = [...datos].sort(
        (a, b) => new Date(a.fecha) - new Date(b.fecha)
      );

      grafico = new Chart(ctx, {
        type: "line",
        data: {
          labels: ordenados.map((e) => formatearFecha(e.fecha)),
          datasets: [
            {
              label: "Peso (kg)",
              data: ordenados.map((e) => e.peso),
              borderColor: "#16a34a",
              backgroundColor: "#86efac",
              tension: 0.3,
            },
          ],
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: false } },
        },
      });
    }

    // -------------------------
    // ORDEN VISUAL
    // -------------------------
    function ordenarAsc() {
      ordenActual = "asc";
      actualizarTabla();
    }

    function ordenarDesc() {
      ordenActual = "desc";
      actualizarTabla();
    }

    // -------------------------
    // CAMBIO DE MEN√öS
    // -------------------------
    function mostrarSemanal() {
      document.getElementById("menuSemanal").classList.remove("hidden");
      document.getElementById("menuSemanal").classList.add("block");

      document.getElementById("menuMensual").classList.add("hidden");
      document.getElementById("menuMensual").classList.remove("block");
    }

function mostrarMensual() {
  document.getElementById("menuMensual").classList.remove("hidden");
  document.getElementById("menuMensual").classList.add("block");

  document.getElementById("menuSemanal").classList.add("hidden");
  document.getElementById("menuSemanal").classList.remove("block");

  actualizarMensual(); // <-- carga la tabla al entrar
}



    // -------------------------
    // INICIO
    // -------------------------
    mostrarFrase();
    actualizarTabla();
    actualizarGrafico();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js").catch(() => {});
    }
  </script>
</body>
</html>













































